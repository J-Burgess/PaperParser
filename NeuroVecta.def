#Singularity container definition file for NeuroVecta.

Bootstrap: docker
From: continuumio/miniconda3:4.10.3


#Download repo and install snakemake.
%post
    apt-get update && apt-get install -y build-essential
    git clone https://github.com/J-Burgess/NeuroVecta /REPO/NeuroVecta


    # Update conda and create a new environment with snakemake
    conda update --quiet -n base -c defaults conda -y
    conda install --quiet -n base -c conda-forge mamba -y
    conda create --quiet -n neurovecta_env -c conda-forge openai -y

    . /opt/conda/etc/profile.d/conda.sh
    conda activate neurovecta_env
    pip install --no-cache-dir langchain chromadb PyPDF2 unstructured

#Ensure conda environment is available at runtime
%environment
    export PATH="/opt/conda/envs/neurovecta_env/bin:$PATH"



#Execute any arguments passed after the singularity run command.
%runscript
    exec "${@}"
